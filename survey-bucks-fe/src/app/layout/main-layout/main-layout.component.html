<div class="main-layout-container" [class.dark-mode]="isDarkMode">
  <!-- Skip Links for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <a href="#navigation-menu" class="skip-link">Skip to navigation menu</a>
  <a href="#page-footer" class="skip-link">Skip to footer</a>

  <mat-toolbar color="primary" class="main-toolbar" id="main-toolbar">
    <div class="toolbar-left">
      <button mat-icon-button *ngIf="isMobileView" (click)="toggleSidenav()" aria-label="Menu toggle">
        <mat-icon>menu</mat-icon>
      </button>
      <div class="logo" routerLink="/">
        <img style="height: 60px;" src="assets/SurveyBucksLogoHorizontal.png" alt="SurveyBucks Logo">
      </div>
    </div>
    
    <div class="toolbar-right">
      <!-- Search button (can be expanded) -->
      <button mat-icon-button aria-label="Search" matTooltip="Search" class="search-btn">
        <mat-icon>search</mat-icon>
      </button>
      
      <!-- Dark mode toggle -->
      <button mat-icon-button (click)="toggleTheme()" [matTooltip]="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'" [attr.aria-label]="isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'">
        <mat-icon>{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
      </button>

      <!-- Profile completion indicator -->
      <button
        mat-icon-button
        class="profile-completion-btn"
        [class.pulsing]="isProfileIncomplete()"
        [matTooltip]="profileCompletionLoading ? 'Loading...' : (profileCompletionPercentage < 100 ? 'Complete your profile to unlock all features' : 'Profile complete!')"
        (click)="navigateToProfile()"
        aria-label="Profile completion: {{profileCompletionPercentage}}%">
        <div class="profile-completion-indicator">
          <mat-spinner
            *ngIf="profileCompletionLoading"
            diameter="24"
            mode="indeterminate">
          </mat-spinner>
          <svg *ngIf="!profileCompletionLoading" class="progress-ring" width="36" height="36">
            <circle
              class="progress-ring-circle-bg"
              stroke="#e0e0e0"
              stroke-width="3"
              fill="transparent"
              r="15"
              cx="18"
              cy="18"/>
            <circle
              class="progress-ring-circle"
              [attr.stroke]="getProfileCompletionColor() === 'warn' ? '#f44336' : (getProfileCompletionColor() === 'accent' ? '#ff9800' : '#4caf50')"
              stroke-width="3"
              fill="transparent"
              r="15"
              cx="18"
              cy="18"
              [style.stroke-dasharray]="94.25"
              [style.stroke-dashoffset]="94.25 - (94.25 * profileCompletionPercentage / 100)"
              stroke-linecap="round"/>
          </svg>
          <span *ngIf="!profileCompletionLoading" class="percentage-text">{{profileCompletionPercentage}}</span>
        </div>
      </button>

      <!-- Notification dropdown -->
      <app-notification-dropdown
        [maxItems]="5"
        (markAsRead)="onNotificationRead($event)">
      </app-notification-dropdown>
      
      <!-- User menu -->
      <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
        <div class="user-avatar" [style.background-color]="isDarkMode ? '#4f4f4f' : '#eeeeee'">
          <span>{{currentUser?.firstName?.charAt(0)}}{{currentUser?.lastName?.charAt(0)}}</span>
        </div>
        <span class="user-name">{{currentUser?.firstName}} {{currentUser?.lastName}}</span>
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
      
      <mat-menu #userMenu="matMenu" class="user-menu">
        <div class="user-menu-header">
          <div class="user-info">
            <div class="user-avatar-large">
              <span>{{currentUser?.firstName?.charAt(0)}}{{currentUser?.lastName?.charAt(0)}}</span>
            </div>
            <div class="user-details">
              <h3>{{currentUser?.firstName}} {{currentUser?.lastName}}</h3>
              <p>{{currentUser?.email}}</p>
            </div>
          </div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/client/profile">
          <mat-icon>person</mat-icon>
          <span>My Profile</span>
        </button>
        <button mat-menu-item routerLink="/client/settings">
          <mat-icon>settings</mat-icon>
          <span>Settings</span>
        </button>
        <button mat-menu-item routerLink="/client/wallet">
          <mat-icon>account_balance_wallet</mat-icon>
          <span>Wallet</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/client/help">
          <mat-icon>help</mat-icon>
          <span>Help & Support</span>
        </button>
        <button mat-menu-item (click)="logout()">
          <mat-icon>exit_to_app</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>
  </mat-toolbar>
  
  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav [mode]="isMobileView ? 'over' : 'side'"
                [opened]="sidenavOpen"
                [fixedInViewport]="isMobileView"
                [disableClose]="!isMobileView"
                class="sidenav"
                id="navigation-menu">
      <div class="sidenav-header">
        <h2>Menu</h2>
      </div>
      
      <mat-nav-list>
        <a mat-list-item *ngFor="let item of navigation" 
           [routerLink]="item.route" 
           routerLinkActive="active-link" 
           [class.active-link]="activePage === item.route"
           class="nav-item"
           matRipple>
          <div class="nav-item-content">
            <mat-icon matListItemIcon>{{item.icon}}</mat-icon>
            <div class="nav-item-details">
              <span matListItemLine class="nav-item-label">{{item.label}}</span>
              <span matListItemLine class="nav-item-description">{{item.description}}</span>
            </div>
            <span *ngIf="item.label === 'Notifications' && unreadNotifications > 0" 
                  class="notification-badge">
              {{unreadNotifications}}
            </span>
          </div>
        </a>
      </mat-nav-list>
      
      <div class="sidenav-footer">
        
      </div>
    </mat-sidenav>
    
    <mat-sidenav-content class="content-container">
      <div class="page-header" *ngIf="activePage">
        <h1 class="page-title">
          <!-- {{ navigation.find(nav => nav.route === activePage)?.label || 'Dashboard' }} -->
        </h1>
        <breadcrumb></breadcrumb>
      </div>
      
      <main id="main-content" class="content-wrapper">
        <router-outlet></router-outlet>
      </main>

      <footer id="page-footer" class="footer">
        <div class="copyright">
          &copy; 2025 SurveyBucks. All rights reserved.
        </div>
        <div class="footer-links">
          <a routerLink="/terms">Terms</a>
          <a routerLink="/privacy">Privacy</a>
          <a routerLink="/contact">Contact</a>
        </div>
      </footer>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>