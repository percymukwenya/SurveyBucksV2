<div class="pending-banking-container">
  <div class="filters-section">
    <h3>Pending Banking Details</h3>
    
    <div class="filters">
      <mat-form-field appearance="outline">
        <mat-label>Filter by Bank Name</mat-label>
        <input matInput [(ngModel)]="filterBankName" (ngModelChange)="applyFilters()" placeholder="Search bank names...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Account Type</mat-label>
        <mat-select [(value)]="filterAccountType" (selectionChange)="applyFilters()">
          <mat-option value="">All Types</mat-option>
          <mat-option value="Checking">Checking</mat-option>
          <mat-option value="Savings">Savings</mat-option>
          <mat-option value="BusinessChecking">Business Checking</mat-option>
          <mat-option value="BusinessSavings">Business Savings</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="loadPendingBankingDetails()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </div>

  <!-- Batch Actions -->
  <div class="batch-actions" *ngIf="selectedBankingDetails.selected.length > 0">
    <mat-card>
      <div class="batch-header">
        <h4>Batch Actions ({{ selectedBankingDetails.selected.length }} selected)</h4>
      </div>
      
      <div class="batch-controls">
        <mat-form-field appearance="outline">
          <mat-label>Action</mat-label>
          <mat-select [(value)]="batchAction">
            <mat-option value="approve">Approve</mat-option>
            <mat-option value="reject">Reject</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" *ngIf="batchAction === 'reject'">
          <mat-label>Notes (required for rejection)</mat-label>
          <textarea matInput [(ngModel)]="batchNotes" rows="2" placeholder="Reason for rejection..."></textarea>
        </mat-form-field>

        <button mat-raised-button 
                [color]="batchAction === 'approve' ? 'primary' : 'warn'"
                (click)="batchVerifyBankingDetails()">
          <mat-icon>{{ batchAction === 'approve' ? 'check' : 'close' }}</mat-icon>
          {{ batchAction === 'approve' ? 'Approve' : 'Reject' }} Selected
        </button>
      </div>
    </mat-card>
  </div>

  <!-- Banking Details Table -->
  <div class="table-container">
    <table mat-table [dataSource]="filteredBankingDetails" class="banking-table">
      
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox 
            (change)="$event ? masterToggle() : null"
            [checked]="selectedBankingDetails.hasValue() && isAllSelected()"
            [indeterminate]="selectedBankingDetails.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox 
            (click)="$event.stopPropagation()"
            (change)="$event ? selectedBankingDetails.toggle(row) : null"
            [checked]="selectedBankingDetails.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- User Column -->
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef>User</th>
        <td mat-cell *matCellDef="let detail">
          <div class="user-info">
            <div class="user-name">{{ detail.userName }}</div>
            <div class="user-email">{{ detail.userEmail }}</div>
          </div>
        </td>
      </ng-container>

      <!-- Bank Name Column -->
      <ng-container matColumnDef="bankName">
        <th mat-header-cell *matHeaderCellDef>Bank Name</th>
        <td mat-cell *matCellDef="let detail">{{ detail.bankName }}</td>
      </ng-container>

      <!-- Account Holder Name Column -->
      <ng-container matColumnDef="accountHolderName">
        <th mat-header-cell *matHeaderCellDef>Account Holder</th>
        <td mat-cell *matCellDef="let detail">{{ detail.accountHolderName }}</td>
      </ng-container>

      <!-- Account Number Column -->
      <ng-container matColumnDef="accountNumber">
        <th mat-header-cell *matHeaderCellDef>Account Number</th>
        <td mat-cell *matCellDef="let detail">
          <span class="account-number">{{ maskAccountNumber(detail.accountNumber) }}</span>
        </td>
      </ng-container>

      <!-- Account Type Column -->
      <ng-container matColumnDef="accountType">
        <th mat-header-cell *matHeaderCellDef>Account Type</th>
        <td mat-cell *matCellDef="let detail">
          <span class="account-type">{{ getAccountTypeDisplayName(detail.accountType) }}</span>
        </td>
      </ng-container>

      <!-- Branch Code Column -->
      <ng-container matColumnDef="branchCode">
        <th mat-header-cell *matHeaderCellDef>Branch Code</th>
        <td mat-cell *matCellDef="let detail">{{ detail.branchCode }}</td>
      </ng-container>

      <!-- Created Date Column -->
      <ng-container matColumnDef="createdDate">
        <th mat-header-cell *matHeaderCellDef>Submitted</th>
        <td mat-cell *matCellDef="let detail">{{ formatDate(detail.createdDate) }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let detail">
          <button mat-icon-button 
                  color="primary" 
                  (click)="selectBankingDetail(detail)"
                  matTooltip="Verify this banking detail">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
          [class.selected-row]="selectedBankingDetail?.id === row.id"
          (click)="selectBankingDetail(row)"></tr>
    </table>

    <div *ngIf="loading" class="loading-container">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      <p>Loading pending banking details...</p>
    </div>

    <div *ngIf="!loading && filteredBankingDetails.length === 0" class="no-data">
      <mat-icon>account_balance</mat-icon>
      <h3>No Pending Banking Details</h3>
      <p>All banking details have been verified or there are none submitted.</p>
    </div>
  </div>

  <!-- Verification Panel -->
  <div class="verification-panel" *ngIf="selectedBankingDetail">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Verify Banking Details</mat-card-title>
        <mat-card-subtitle>{{ selectedBankingDetail.userName }} - {{ selectedBankingDetail.userEmail }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="banking-details">
          <div class="detail-row">
            <span class="label">Bank Name:</span>
            <span class="value">{{ selectedBankingDetail.bankName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Account Holder:</span>
            <span class="value">{{ selectedBankingDetail.accountHolderName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Account Number:</span>
            <span class="value">{{ selectedBankingDetail.accountNumber }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Account Type:</span>
            <span class="value">{{ getAccountTypeDisplayName(selectedBankingDetail.accountType) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Branch Code:</span>
            <span class="value">{{ selectedBankingDetail.branchCode }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Primary Account:</span>
            <span class="value">{{ selectedBankingDetail.isPrimary ? 'Yes' : 'No' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Submitted:</span>
            <span class="value">{{ formatDate(selectedBankingDetail.createdDate) }}</span>
          </div>
        </div>

        <div class="verification-controls">
          <mat-form-field appearance="outline">
            <mat-label>Action</mat-label>
            <mat-select [(value)]="verificationAction">
              <mat-option value="approve">Approve</mat-option>
              <mat-option value="reject">Reject</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" *ngIf="verificationAction === 'reject'">
            <mat-label>Notes (required for rejection)</mat-label>
            <textarea matInput [(ngModel)]="verificationNotes" rows="3" placeholder="Reason for rejection..."></textarea>
          </mat-form-field>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-raised-button 
                [color]="verificationAction === 'approve' ? 'primary' : 'warn'"
                (click)="verifyBankingDetail()">
          <mat-icon>{{ verificationAction === 'approve' ? 'check' : 'close' }}</mat-icon>
          {{ verificationAction === 'approve' ? 'Approve' : 'Reject' }}
        </button>
        <button mat-button (click)="selectedBankingDetail = null">Cancel</button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>