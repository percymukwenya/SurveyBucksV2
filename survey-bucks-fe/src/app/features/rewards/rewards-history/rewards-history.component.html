<!-- src/app/features/rewards/rewards-history/rewards-history.component.html -->
<div class="rewards-history-container">
    <div class="page-header">
      <h1>Rewards History</h1>
      <p class="subtitle">Track your points and redemption history</p>
      
      <div class="header-actions">
        <button mat-stroked-button routerLink="/client/rewards">
          <mat-icon>card_giftcard</mat-icon>
          Back to Rewards
        </button>
      </div>
    </div>
    
    <div class="points-summary">
      <mat-card>
        <mat-card-content>
          <div class="summary-item">
            <div class="summary-icon current-icon">
              <mat-icon>account_balance_wallet</mat-icon>
            </div>
            <div class="summary-content">
              <span class="summary-value">{{userPoints.currentPoints | number}}</span>
              <span class="summary-label">Current Balance</span>
            </div>
          </div>
          
          <div class="summary-item">
            <div class="summary-icon earned-icon">
              <mat-icon>add_circle</mat-icon>
            </div>
            <div class="summary-content">
              <span class="summary-value">{{userPoints.totalPointsEarned | number}}</span>
              <span class="summary-label">Total Earned</span>
            </div>
          </div>
          
          <div class="summary-item">
            <div class="summary-icon spent-icon">
              <mat-icon>remove_circle</mat-icon>
            </div>
            <div class="summary-content">
              <span class="summary-value">{{userPoints.totalPointsSpent | number}}</span>
              <span class="summary-label">Total Spent</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    
    <div *ngIf="loading" class="loading-container">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      <p>Loading rewards history...</p>
    </div>
    
    <div *ngIf="!loading" class="history-content">
      <mat-tab-group animationDuration="0ms">
        <mat-tab label="Points History">
          <div class="tab-content">
            <mat-card>
              <mat-card-content>
                <div class="table-container">
                  <table mat-table [dataSource]="pointTransactions" matSort #transactionTable>
                    <!-- Date Column -->
                    <ng-container matColumnDef="date">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
                      <td mat-cell *matCellDef="let transaction">{{transaction.timestamp | date}}</td>
                    </ng-container>
                    
                    <!-- Description Column -->
                    <ng-container matColumnDef="description">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
                      <td mat-cell *matCellDef="let transaction">{{transaction.description}}</td>
                    </ng-container>
                    
                    <!-- Type Column -->
                    <ng-container matColumnDef="type">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                      <td mat-cell *matCellDef="let transaction">
                        <div class="transaction-type" [ngClass]="getTransactionTypeClass(transaction.type)">
                          <mat-icon>{{getTransactionTypeIcon(transaction.type)}}</mat-icon>
                          <span>{{transaction.type}}</span>
                        </div>
                      </td>
                    </ng-container>
                    
                    <!-- Amount Column -->
                    <ng-container matColumnDef="amount">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Amount</th>
                      <td mat-cell *matCellDef="let transaction">
                        <span [ngClass]="{'positive': transaction.amount > 0, 'negative': transaction.amount < 0}">
                          {{transaction.amount > 0 ? '+' : ''}}{{transaction.amount | number}}
                        </span>
                      </td>
                    </ng-container>
                    
                    <!-- Balance Column -->
                    <ng-container matColumnDef="balance">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Balance</th>
                      <td mat-cell *matCellDef="let transaction">{{transaction.balance | number}}</td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="transactionColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: transactionColumns;"></tr>
                    
                    <!-- No Data Row -->
                    <tr class="mat-row" *matNoDataRow>
                      <td class="mat-cell" colspan="5">
                        <div class="no-data-message">
                          <mat-icon>history</mat-icon>
                          <p>No point transactions found.</p>
                        </div>
                      </td>
                    </tr>
                  </table>
                  
                  <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>
        
        <mat-tab label="Redemption History">
          <div class="tab-content">
            <mat-card>
              <mat-card-content>
                <div class="table-container">
                  <table mat-table [dataSource]="userRewards" matSort #rewardsTable>
                    <!-- Date Column -->
                    <ng-container matColumnDef="date">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
                      <td mat-cell *matCellDef="let reward">{{reward.earnedDate | date}}</td>
                    </ng-container>
                    
                    <!-- Name Column -->
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Reward</th>
                      <td mat-cell *matCellDef="let reward">
                        <div class="reward-name">
                          {{reward.rewardName}}
                          <p class="reward-description">{{reward.rewardDescription | slice:0:100}}{{reward.rewardDescription.length > 100 ? '...' : ''}}</p>
                        </div>
                      </td>
                    </ng-container>
                    
                    <!-- Type Column -->
                    <ng-container matColumnDef="type">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                      <td mat-cell *matCellDef="let reward">{{reward.rewardType}}</td>
                    </ng-container>
                    
                    <!-- Points Column -->
                    <ng-container matColumnDef="points">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Points</th>
                      <td mat-cell *matCellDef="let reward">{{reward.rewardAmount | number}}</td>
                    </ng-container>
                    
                    <!-- Status Column -->
                    <ng-container matColumnDef="status">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
                      <td mat-cell *matCellDef="let reward">
                        <div class="reward-status" [ngClass]="getRewardStatusClass(reward.redemptionStatus)">
                          {{reward.redemptionStatus}}
                        </div>
                        
                        <button *ngIf="reward.redemptionStatus === 'Ready'" 
                               mat-button 
                               color="primary"
                               [routerLink]="['/client/rewards/claim', reward.id]">
                          Claim
                        </button>
                      </td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="rewardsColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: rewardsColumns;"></tr>
                    
                    <!-- No Data Row -->
                    <tr class="mat-row" *matNoDataRow>
                      <td class="mat-cell" colspan="5">
                        <div class="no-data-message">
                          <mat-icon>card_giftcard</mat-icon>
                          <p>No rewards redeemed yet.</p>
                        </div>
                      </td>
                    </tr>
                  </table>
                  
                  <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
